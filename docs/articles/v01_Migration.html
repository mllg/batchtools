<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Migrating from BatchJobs/BatchExperiments • batchtools</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">batchtools</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mllg/batchtools">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Migrating from BatchJobs/BatchExperiments</h1>
            
          </div>

    
    
<div class="contents">
<p>The development of <a href="https://github.com/tudo-r/BatchJobs/">BatchJobs</a> and <a href="https://github.com/tudo-r/Batchexperiments">BatchExperiments</a> is discontinued because of the following reasons:</p>
<ul>
<li>Maintainability: The packages <a href="https://github.com/tudo-r/BatchJobs/">BatchJobs</a> and <a href="https://github.com/tudo-r/Batchexperiments">BatchExperiments</a> are tightly connected which makes maintaining difficult. Changes have to be synchronized and tested against the current CRAN versions for compatibility. Furthermore, BatchExperiments violates CRAN policies by calling internal functions of BatchJobs.</li>
<li>Data base issues: Although we invested weeks to mitigate issues with locks of the SQLite data base or file system (staged queries, file system timeouts, …), BatchJobs kept working unreliable on some systems with high latency or specific file systems. This made BatchJobs unusable for many users.</li>
</ul>
<p><a href="https://github.com/tudo-r/BatchJobs/">BatchJobs</a> and <a href="https://github.com/tudo-r/Batchexperiments">BatchExperiments</a> will remain on CRAN, but new features are unlikely to be ported back.</p>
<div id="comparison-with-batchjobsbatchexperiments" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#comparison-with-batchjobsbatchexperiments" class="anchor"> </a></body></html>Comparison with BatchJobs/BatchExperiments</h1>
<div id="internal-changes" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#internal-changes" class="anchor"> </a></body></html>Internal changes</h2>
<ul>
<li>batchtools does not use SQLite anymore. Instead, all the information is stored directly in the registry using <a href="https://cran.r-project.org/package=data.table">data.tables</a> acting as an in-memory database. As a side effect, many operations are much faster.</li>
<li>Nodes do not have to access the registry. <a href="https://mllg.github.io/batchtools/reference/submitJobs">submitJobs()</a> stores a temporary object of type <a href="https://mllg.github.io/batchtools/reference/JobCollection">JobCollection</a> on the file system which holds all the information necessary to execute a chunk of jobs via <a href="https://mllg.github.io/batchtools/reference/doJobCollection">doJobCollection()</a> on the node. This avoids file system locks because each job accesses only one file exclusively.</li>
<li>
<code>ClusterFunctionsMulticore</code> now uses the parallel package for multicore execution. <code>ClusterFunctionsSSH</code> can still be used to emulate a scheduler-like system which respects the work load on the local machine.</li>
</ul>
</div>
<div id="interface-changes" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#interface-changes" class="anchor"> </a></body></html>Interface changes</h2>
<ul>
<li>batchtools remembers the last created or loaded Registry and sets it as default registry. This way, you do not need to pass the registry around anymore. If you need to work with multiple registries simultaneously on the other hand, you can still do so by explicitly passing registries to the functions.</li>
<li>Most functions now return a <a href="https://cran.r-project.org/package=data.table">data.table</a> which is keyed with the <code>job.id</code>. This way, return values can be joined together easily and efficient (see this <a href="https://mllg.github.io/batchtools/reference/JoinTables">help page</a> for some examples).</li>
<li>The building blocks of a problem has been renamed from <code>static</code> and <code>dynamic</code> to the more intuitive <code>data</code> and <code>fun</code>. Thus, algorithm function should have the formal arguments <code>job</code>, <code>data</code> and <code>instance</code>.</li>
<li>The function <code>makeDesign</code> has been removed. Parameters can be defined by just passing a <code>data.frame</code> or <code>data.table</code> to <a href="https://mllg.github.io/batchtools/reference/addExperiments">addExperiments</a>. For exhaustive designs, use <code>expand.grid()</code> or <code>data.table::CJ()</code>.</li>
</ul>
</div>
<div id="template-changes" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#template-changes" class="anchor"> </a></body></html>Template changes</h2>
<ul>
<li>The scheduler should directly execute the command <code>Rscript -e 'batchtools::doJobCollection(&lt;filename&gt;)'</code>. There is no intermediate R source file like in BatchJobs.</li>
<li>All information stored in the object <a href="https://mllg.github.io/batchtools/reference/JobCollection"><code>JobCollection</code></a> can be accessed while brewing the template.</li>
<li>Some variable names have changed and need to be adapted, e.g. <code>job.name</code> is now <code>job.hash</code>.</li>
<li>Extra variables may be passed via the argument <code>resoures</code> of <a href="https://mllg.github.io/batchtools/reference/submitJobs">submitJobs</a>.</li>
</ul>
</div>
<div id="new-features" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#new-features" class="anchor"> </a></body></html>New features</h2>
<ul>
<li>Support for Docker Swarm via <code>ClusterFunctionsDocker</code>.</li>
<li>Jobs can now be tagged and untagged to provide an easy way to group them.</li>
<li>Some resources like the number of CPUs are now optionally passed to <a href="https://cran.r-project.org/package=parallelMap">parallelMap</a>. This eases nested parallelization, e.g. to use multicore parallelization on the slave by just setting a resource on the master. See <a href="https://mllg.github.io/batchtools/reference/submitJobs">submitJobs()</a> for an example.</li>
<li>
<code>ClusterFunctions</code> are now more flexible in general as they can define hook functions which will be called at certain events. <a href="https://github.com/mllg/batchtools/blob/master/R/clusterFunctionsDocker.R">ClusterFunctionsDocker</a> is an example use case which implements a housekeeping routine. This routine is called every time before a job is about to get submitted to the scheduler (in the case: the Docker Swarm) via the hook <code>pre.submit</code> and every time directly after the registry synchronized jobs stored on the file system via the hook <code>post.sync</code>.</li>
<li>More new features are covered in the <a href="https://mllg.github.io/batchtools/news/index.html">NEWS</a>.</li>
</ul>
</div>
</div>
<div id="porting-to-batchtools" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#porting-to-batchtools" class="anchor"> </a></body></html>Porting to batchtools</h1>
<p>The following table assists in porting to batchtools by mapping BatchJobs/BatchExperiments functions to their counterparts in batchtools. The table does not cover functions which are (a) used only internally in BatchJobs and (b) functions which have not been renamed.</p>
<table class="table">
<thead><tr class="header">
<th>BatchJobs</th>
<th align="center">batchtools</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>addRegistryPackages</code></td>
<td align="center">Set <code>reg$packages</code> or <code>reg$namespaces</code>, call <a href="https://mllg.github.io/batchtools/reference/saveRegistry">saveRegistry</a>
</td>
</tr>
<tr class="even">
<td><code>addRegistrySourceDirs</code></td>
<td align="center">-</td>
</tr>
<tr class="odd">
<td><code>addRegistrySourceFiles</code></td>
<td align="center">Set <code>reg$source</code>, call <a href="https://mllg.github.io/batchtools/reference/saveRegistry">saveRegistry</a>
</td>
</tr>
<tr class="even">
<td><code>batchExpandGrid</code></td>
<td align="center">
<a href="https://mllg.github.io/batchtools/reference/batchMap">batchMap</a>: <code><a href="../reference/batchMap.html">batchMap(..., args = CJ(x = 1:3, y = 1:10))</a></code>
</td>
</tr>
<tr class="odd">
<td><code>batchMapQuick</code></td>
<td align="center"><a href="https://mllg.github.io/batchtools/reference/btlapply">btmapply</a></td>
</tr>
<tr class="even">
<td><code>batchReduceResults</code></td>
<td align="center">-</td>
</tr>
<tr class="odd">
<td><code>batchUnexport</code></td>
<td align="center"><a href="https://mllg.github.io/batchtools/reference/batchExport">batchExport</a></td>
</tr>
<tr class="even">
<td><code>filterResults</code></td>
<td align="center">-</td>
</tr>
<tr class="odd">
<td><code>getJobIds</code></td>
<td align="center"><a href="https://mllg.github.io/batchtools/reference/findJobs">findJobs</a></td>
</tr>
<tr class="even">
<td><code>getJobInfo</code></td>
<td align="center"><a href="https://mllg.github.io/batchtools/reference/getJobTable">getJobStatus</a></td>
</tr>
<tr class="odd">
<td><code>getJob</code></td>
<td align="center"><a href="https://mllg.github.io/batchtools/reference/JobExperiment">makeJob</a></td>
</tr>
<tr class="even">
<td><code>getJobParamDf</code></td>
<td align="center"><a href="https://mllg.github.io/batchtools/reference/getJobTable">getJobPars</a></td>
</tr>
<tr class="odd">
<td><code>loadResults</code></td>
<td align="center"><a href="https://mllg.github.io/batchtools/reference/reduceResultsList">reduceResultsList</a></td>
</tr>
<tr class="even">
<td><code>reduceResultsDataFrame</code></td>
<td align="center"><a href="https://mllg.github.io/batchtools/reference/reduceResultsList">reduceResultsDataTable</a></td>
</tr>
<tr class="odd">
<td><code>reduceResultsMatrix</code></td>
<td align="center">
<a href="https://mllg.github.io/batchtools/reference/reduceResultsList">reduceResultsList</a> + <code>do.call(rbind, res)</code>
</td>
</tr>
<tr class="even">
<td><code>reduceResultsVector</code></td>
<td align="center"><a href="https://mllg.github.io/batchtools/reference/reduceResultsList">reduceResultsDataTable</a></td>
</tr>
<tr class="odd">
<td><code>setJobFunction</code></td>
<td align="center">-</td>
</tr>
<tr class="even">
<td><code>setJobNames</code></td>
<td align="center">-</td>
</tr>
<tr class="odd">
<td><code>showStatus</code></td>
<td align="center"><a href="https://mllg.github.io/batchtools/reference/getStatus">getStatus</a></td>
</tr>
</tbody>
</table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#comparison-with-batchjobsbatchexperiments">Comparison with BatchJobs/BatchExperiments</a><ul class="nav nav-pills nav-stacked">
<li><a href="#internal-changes">Internal changes</a></li>
      <li><a href="#interface-changes">Interface changes</a></li>
      <li><a href="#template-changes">Template changes</a></li>
      <li><a href="#new-features">New features</a></li>
      </ul>
</li>
      <li><a href="#porting-to-batchtools">Porting to batchtools</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Michel Lang, Bernd Bischl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
