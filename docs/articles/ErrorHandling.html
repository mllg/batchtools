<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Error handling &bull; batchtools</title><!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">batchtools</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/mllg/batchtools">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Error handling</h1>
            
          </div>

    
    
<div class="contents">
<p>In any large scale experiment many things can and will go wrong. The cluster might have an outage, jobs may run into resource limits or crash, subtile bugs in your code could be triggered or any other error condition might arise. In these situations it is important to quickly determine what went wrong and to recompute only the minimal number of required jobs.</p>
<p>Therefore, before you submit anything you should use <a href="https://mllg.github.io/batchtools/reference/testJob"><code><a href="../reference/testJob.html">testJob()</a></code></a> to catch errors that are easy to spot because they are raised in many or all jobs. If <code>external</code> is set, this function runs the job without side effects in an independent R process on your local machine via <code>Rscript</code> similar as on the slave, redirects the output of the process to your R console, loads the job result and returns it. If you do not set <code>external</code>, the job is executed is in the currently running R session, with the drawback that you might be unable to catch missing variable declarations or missing package dependencies.</p>
<p>By way of illustration here is a small example. First, we create a temporary registry.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(batchtools)
reg =<span class="st"> </span><span class="kw"><a href="../reference/Registry.html">makeRegistry</a></span>(<span class="dt">file.dir =</span> <span class="ot">NA</span>, <span class="dt">seed =</span> <span class="dv">1</span>)</code></pre></div>
<p>Ten jobs are created, two of them will throw an exception.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flakeyFunction &lt;-<span class="st"> </span>function(value) {
  if (value %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">9</span>)) <span class="kw">stop</span>(<span class="st">"Ooops."</span>)
  value^<span class="dv">2</span>
}
<span class="kw"><a href="../reference/batchMap.html">batchMap</a></span>(flakeyFunction, <span class="dv">1</span>:<span class="dv">10</span>)</code></pre></div>
<pre><code>## Adding 10 jobs ...</code></pre>
<p>Now that the jobs are defined, we can test jobs independently:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/testJob.html">testJob</a></span>(<span class="dt">id =</span> <span class="dv">1</span>)</code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>In this case, testing the job with ID = 1 provides the appropriate result but testing the job with ID = 2 leads to an error:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.character</span>(<span class="kw">try</span>(<span class="kw"><a href="../reference/testJob.html">testJob</a></span>(<span class="dt">id =</span> <span class="dv">2</span>)))</code></pre></div>
<pre><code>## [1] "Error in (function (value)  : Ooops.\n"</code></pre>
<p>When you have already submitted the jobs and suspect that something is going wrong, the first thing to do is to run <a href="https://mllg.github.io/batchtools/reference/getStatus"><code><a href="../reference/getStatus.html">getStatus()</a></code></a> to display a summary of the current state of the system.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/submitJobs.html">submitJobs</a></span>()</code></pre></div>
<pre><code>## Submitting 10 jobs in 10 chunks using cluster functions 'Interactive' ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/getStatus.html">getStatus</a></span>()</code></pre></div>
<pre><code>## Syncing 10 files ...</code></pre>
<pre><code>## Status for 10 jobs:
##   Submitted : 10 (100.0%)
##   Queued    :  0 (  0.0%)
##   Started   : 10 (100.0%)
##   Running   :  0 (  0.0%)
##   Done      :  8 ( 80.0%)
##   Error     :  2 ( 20.0%)
##   Expired   :  0 (  0.0%)</code></pre>
<p>The status message shows that two of the jobs could not be executed successfully. To get the IDs of all jobs that failed due to an error we can use <a href="https://mllg.github.io/batchtools/reference/findJobs"><code><a href="../reference/findJobs.html">findErrors()</a></code></a> and to retrieve the actual error message, we can use <a href="https://mllg.github.io/batchtools/reference/getErrorMessages"><code><a href="../reference/getErrorMessages.html">getErrorMessages()</a></code></a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/findJobs.html">findErrors</a></span>()</code></pre></div>
<pre><code>##    job.id
## 1:      2
## 2:      9</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/getErrorMessages.html">getErrorMessages</a></span>()</code></pre></div>
<pre><code>##    job.id terminated error                              message
## 1:      2       TRUE  TRUE Error in (function (value)  : Ooops.
## 2:      9       TRUE  TRUE Error in (function (value)  : Ooops.</code></pre>
<p>If we want to peek into the R log file of a job to see more context for the error we can use <a href="https://mllg.github.io/batchtools/reference/showLog"><code><a href="../reference/showLog.html">showLog()</a></code></a> which opens a pager or use <a href="https://mllg.github.io/batchtools/reference/showLog"><code><a href="../reference/showLog.html">getLog()</a></code></a> to get the log as character vector:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">writeLines</span>(<span class="kw"><a href="../reference/showLog.html">getLog</a></span>(<span class="dt">id =</span> <span class="dv">9</span>))</code></pre></div>
<pre><code>## ### [bt 2016-12-13 16:20:23]: Starting calculation of 1 jobs
## ### [bt 2016-12-13 16:20:23]: Setting working directory to 'C:/Users/surmann/Documents/Repositories/batchtools/docs/articles'
## ### [bt 2016-12-13 16:20:23]: Memory measurement disabled
## ### [bt 2016-12-13 16:20:23]: Starting job [batchtools job.id=9]
## Error in (function (value)  : Ooops.
## 
## ### [bt 2016-12-13 16:20:23]: Job terminated with an exception [batchtools job.id=9]
## ### [bt 2016-12-13 16:20:23]: Calculation finished!</code></pre>
<p>You can also grep for error or warning messages:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ids =<span class="st"> </span><span class="kw"><a href="../reference/grepLogs.html">grepLogs</a></span>(<span class="dt">pattern =</span> <span class="st">"ooops"</span>, <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>)
<span class="kw">print</span>(ids)</code></pre></div>
<pre><code>##    job.id                              matches
## 1:      2 Error in (function (value)  : Ooops.
## 2:      9 Error in (function (value)  : Ooops.</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Michel Lang, Bernd Bischl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer></div>

  </body></html>
