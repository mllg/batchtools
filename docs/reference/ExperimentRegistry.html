<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>ExperimentRegistry. batchtools</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>

<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>

<!-- mathjax -->
<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
  </head>

  <body>
    <div class="container">
      <header>
      
<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">batchtools</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mllg/batchtools">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
      
      </header>

      <div class="page-header">
  <h1>ExperimentRegistry Constructor</h1>
</div>

<div class="row">
  <div class="col-md-9">
    
    <p><code>makeExperimentRegistry</code> constructs a special <code><a href='Registry.html'>Registry</a></code> which
is suitable for the definition of large scale computer experiments.</p>

    <p>Each experiments consists of a <code><a href='ProblemAlgorithm.html'>Problem</a></code> and an <code><a href='ProblemAlgorithm.html'>Algorithm</a></code>.
These can be parametrized with <code><a href='addExperiments.html'>addExperiments</a></code> to actually define computational
jobs.</p>
    

    <pre><span class='fu'>makeExperimentRegistry</span>(<span class='kw'>file.dir</span> <span class='kw'>=</span> <span class='st'>"registry"</span>, <span class='kw'>work.dir</span> <span class='kw'>=</span> <span class='fu'>getwd</span>(),
  <span class='kw'>conf.file</span> <span class='kw'>=</span> <span class='fu'>findConfFile</span>(), <span class='kw'>packages</span> <span class='kw'>=</span> <span class='fu'>character</span>(<span class='fl'>0L</span>),
  <span class='kw'>namespaces</span> <span class='kw'>=</span> <span class='fu'>character</span>(<span class='fl'>0L</span>), <span class='kw'>source</span> <span class='kw'>=</span> <span class='fu'>character</span>(<span class='fl'>0L</span>),
  <span class='kw'>load</span> <span class='kw'>=</span> <span class='fu'>character</span>(<span class='fl'>0L</span>), <span class='kw'>seed</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>make.default</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>
    
    <h2>Arguments</h2>
    <dl class="dl-horizontal">
      <dt>file.dir</dt>
      <dd>[<code>character(1)</code>]
  Path where all files of the registry are saved.
  Default is directory &#8220;registry&#8221; in the current working directory.
  The provided path will get normalized unless it is given relative to the home directory
  (i.e., starting with &#8220;~&#8221;). Note that some templates do not handle relative paths well.

  If you pass <code>NA</code>, a temporary directory will be used.
  This way, you can create disposable registries for <code><a href='btlapply.html'>btlapply</a></code> or examples.
  By default, the temporary directory <code><a href='http://www.rdocumentation.org/packages/tempfile/topics/base'>tempdir</a>()</code> will be used.
  If you want to use another directory, e.g. a directory which is shared between nodes,
  you can set it in your configuration file by setting the variable <code>temp.dir</code>.</dd>
      <dt>work.dir</dt>
      <dd>[<code>character(1)</code>]
  Working directory for R process for running jobs.
  Defaults to the working directory currently set during Registry construction (see <code><a href='http://www.rdocumentation.org/packages/getwd/topics/base'>getwd</a></code>).
  <code>loadRegistry</code> uses the stored <code>work.dir</code>, but you may also explicitly overwrite it,
  e.g., after switching to another system.

  The provided path will get normalized unless it is given relative to the home directory
  (i.e., starting with &#8220;~&#8221;). Note that some templates do not handle relative paths well.</dd>
      <dt>conf.file</dt>
      <dd>[<code>character(1)</code>]
  Path to a configuration file which is sourced while the registry is created.
  For example, you can set cluster functions or default resources in it.
  The script is executed inside the environment of the registry after the defaults for all variables are set,
  thus you can set and overwrite slots, e.g. <code>default.resources = list(walltime = 3600)</code> to set default resources.

  The file lookup defaults to a heuristic which first tries to read &#8220;batchtools.conf.R&#8221; in the current working directory.
  If not found, it looks for a configuration file &#8220;config.R&#8221; in the OS dependent user configuration directory
  as reported by via <code>rappdirs::user_config_dir(&quot;batchtools&quot;, expand = FALSE)</code> (e.g., on linux this
  usually resolves to &#8220;~/.config/batchtools/config.R&#8221;).
  If this file is also not found, the heuristic finally tries to read the file &#8220;.batchtools.conf.R&#8221; in the
  home directory (&#8220;~&#8221;).
  Set to <code>character(0)</code> if you want to disable this heuristic.</dd>
      <dt>packages</dt>
      <dd>[<code>character</code>]
Packages that will always be loaded on each node.
Uses <code><a href='http://www.rdocumentation.org/packages/library/topics/base'>require</a></code> internally.
Default is <code>character(0)</code>.</dd>
      <dt>namespaces</dt>
      <dd>[<code>character</code>]
Same as <code>packages</code>, but the packages will not be attached.
Uses <code><a href='http://www.rdocumentation.org/packages/ns-load/topics/base'>requireNamespace</a></code> internally.
Default is <code>character(0)</code>.</dd>
      <dt>source</dt>
      <dd>[<code>character</code>]
Files which should be sourced on the slaves prior to executing a job.
Calls <code><a href='http://www.rdocumentation.org/packages/sys.source/topics/base'>sys.source</a></code> using the <code><a href='http://www.rdocumentation.org/packages/environment/topics/base'>.GlobalEnv</a></code>.</dd>
      <dt>load</dt>
      <dd>[<code>character</code>]
Files which should be loaded on the slaves prior to executing a job.
Calls <code><a href='http://www.rdocumentation.org/packages/load/topics/base'>load</a></code> using the <code><a href='http://www.rdocumentation.org/packages/environment/topics/base'>.GlobalEnv</a></code>.</dd>
      <dt>seed</dt>
      <dd>[<code>integer(1)</code>]
Start seed for jobs. Each job uses the (<code>seed</code> + <code>job.id</code>) as seed.
Default is a random number in the range [1, <code>.Machine$integer.max/2</code>].</dd>
      <dt>make.default</dt>
      <dd>[<code>logical(1)</code>]
If set to <code>TRUE</code>, the created registry is saved inside the package
namespace and acts as default registry. You might want to switch this
off if you work with multiple registries simultaneously.
Default is <code>TRUE</code>.</dd>
    </dl>
    
    <div class="Value">
      <h2>Value</h2>

      <p>[<code>ExperimentRegistry</code>].</p>
    </div>

    <div class="See also">
      <h2>See also</h2>

      <p>Other Experiment: <code><a href='addExperiments.html'>addExperiments</a></code>,
  <code><a href='removeExperiments.html'>removeExperiments</a></code>,
  <code><a href='summarizeExperiments.html'>summarizeExperiments</a></code></p>
    </div>
    
    <h2 id="examples">Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>tmp</span> <span class='kw'>=</span> <span class='fu'>makeExperimentRegistry</span>(<span class='kw'>file.dir</span> <span class='kw'>=</span> <span class='fl'>NA</span>, <span class='kw'>make.default</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output'><strong class='text-info'>Sourcing configuration file &#39;/home/lang/.config/batchtools/config.R&#39; ...</strong></div><div class='input'>
<span class='co'># Definde one problem, two algorithms and add them with some parameters:</span>
<span class='fu'><a href='ProblemAlgorithm.html'>addProblem</a></span>(<span class='kw'>reg</span> <span class='kw'>=</span> <span class='no'>tmp</span>, <span class='st'>"p1"</span>,
  <span class='kw'>fun</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>job</span>, <span class='no'>data</span>, <span class='no'>n</span>, <span class='no'>mean</span>, <span class='no'>sd</span>, <span class='no'>...</span>) <span class='fu'>rnorm</span>(<span class='no'>n</span>, <span class='kw'>mean</span> <span class='kw'>=</span> <span class='no'>mean</span>, <span class='kw'>sd</span> <span class='kw'>=</span> <span class='no'>sd</span>))
<span class='fu'><a href='ProblemAlgorithm.html'>addAlgorithm</a></span>(<span class='kw'>reg</span> <span class='kw'>=</span> <span class='no'>tmp</span>, <span class='st'>"a1"</span>, <span class='kw'>fun</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>job</span>, <span class='no'>data</span>, <span class='no'>instance</span>, <span class='no'>...</span>) <span class='fu'>mean</span>(<span class='no'>instance</span>))
<span class='fu'><a href='ProblemAlgorithm.html'>addAlgorithm</a></span>(<span class='kw'>reg</span> <span class='kw'>=</span> <span class='no'>tmp</span>, <span class='st'>"a2"</span>, <span class='kw'>fun</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>job</span>, <span class='no'>data</span>, <span class='no'>instance</span>, <span class='no'>...</span>) <span class='fu'>median</span>(<span class='no'>instance</span>))
<span class='no'>ids</span> <span class='kw'>=</span> <span class='fu'><a href='addExperiments.html'>addExperiments</a></span>(<span class='kw'>reg</span> <span class='kw'>=</span> <span class='no'>tmp</span>, <span class='fu'>list</span>(<span class='kw'>p1</span> <span class='kw'>=</span> <span class='fu'>CJ</span>(<span class='kw'>n</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>50</span>, <span class='fl'>100</span>), <span class='kw'>mean</span> <span class='kw'>=</span> -<span class='fl'>2</span>:<span class='fl'>2</span>, <span class='kw'>sd</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>4</span>)))</div><div class='output'><strong class='text-info'>Adding 40 experiments (&#39;p1&#39;[40] x &#39;a1&#39;[1] x repls[1]) ...</strong></div><div class='output'><strong class='text-info'>Adding 40 experiments (&#39;p1&#39;[40] x &#39;a2&#39;[1] x repls[1]) ...</strong></div><div class='input'>
<span class='co'># Overview over defined experiments:</span>
<span class='fu'><a href='ProblemAlgorithm.html'>getProblemIds</a></span>(<span class='kw'>reg</span> <span class='kw'>=</span> <span class='no'>tmp</span>)</div><div class='output co'>#&gt; [1] &quot;p1&quot;
#&gt; </div><div class='input'><span class='fu'><a href='ProblemAlgorithm.html'>getAlgorithmIds</a></span>(<span class='kw'>reg</span> <span class='kw'>=</span> <span class='no'>tmp</span>)</div><div class='output co'>#&gt; [1] &quot;a1&quot; &quot;a2&quot;
#&gt; </div><div class='input'><span class='fu'><a href='summarizeExperiments.html'>summarizeExperiments</a></span>(<span class='kw'>reg</span> <span class='kw'>=</span> <span class='no'>tmp</span>)</div><div class='output co'>#&gt;    problem algorithm .count
#&gt; 1:      p1        a1     40
#&gt; 2:      p1        a2     40
#&gt; </div><div class='input'><span class='fu'><a href='summarizeExperiments.html'>summarizeExperiments</a></span>(<span class='kw'>reg</span> <span class='kw'>=</span> <span class='no'>tmp</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"problem"</span>, <span class='st'>"algorithm"</span>, <span class='st'>"n"</span>))</div><div class='output co'>#&gt;    problem algorithm   n .count
#&gt; 1:      p1        a1  50     20
#&gt; 2:      p1        a1 100     20
#&gt; 3:      p1        a2  50     20
#&gt; 4:      p1        a2 100     20
#&gt; </div><div class='input'><span class='no'>ids</span> <span class='kw'>=</span> <span class='fu'><a href='findJobs.html'>findExperiments</a></span>(<span class='kw'>prob.pars</span> <span class='kw'>=</span> (<span class='no'>n</span> <span class='kw'>==</span> <span class='fl'>50</span>), <span class='kw'>reg</span> <span class='kw'>=</span> <span class='no'>tmp</span>)
<span class='fu'><a href='getJobTable.html'>getJobPars</a></span>(<span class='no'>ids</span>, <span class='kw'>reg</span> <span class='kw'>=</span> <span class='no'>tmp</span>)</div><div class='output co'>#&gt;     job.id problem algorithm  n mean sd
#&gt;  1:      1      p1        a1 50   -2  1
#&gt;  2:      2      p1        a1 50   -2  2
#&gt;  3:      3      p1        a1 50   -2  3
#&gt;  4:      4      p1        a1 50   -2  4
#&gt;  5:      5      p1        a1 50   -1  1
#&gt;  6:      6      p1        a1 50   -1  2
#&gt;  7:      7      p1        a1 50   -1  3
#&gt;  8:      8      p1        a1 50   -1  4
#&gt;  9:      9      p1        a1 50    0  1
#&gt; 10:     10      p1        a1 50    0  2
#&gt; 11:     11      p1        a1 50    0  3
#&gt; 12:     12      p1        a1 50    0  4
#&gt; 13:     13      p1        a1 50    1  1
#&gt; 14:     14      p1        a1 50    1  2
#&gt; 15:     15      p1        a1 50    1  3
#&gt; 16:     16      p1        a1 50    1  4
#&gt; 17:     17      p1        a1 50    2  1
#&gt; 18:     18      p1        a1 50    2  2
#&gt; 19:     19      p1        a1 50    2  3
#&gt; 20:     20      p1        a1 50    2  4
#&gt; 21:     41      p1        a2 50   -2  1
#&gt; 22:     42      p1        a2 50   -2  2
#&gt; 23:     43      p1        a2 50   -2  3
#&gt; 24:     44      p1        a2 50   -2  4
#&gt; 25:     45      p1        a2 50   -1  1
#&gt; 26:     46      p1        a2 50   -1  2
#&gt; 27:     47      p1        a2 50   -1  3
#&gt; 28:     48      p1        a2 50   -1  4
#&gt; 29:     49      p1        a2 50    0  1
#&gt; 30:     50      p1        a2 50    0  2
#&gt; 31:     51      p1        a2 50    0  3
#&gt; 32:     52      p1        a2 50    0  4
#&gt; 33:     53      p1        a2 50    1  1
#&gt; 34:     54      p1        a2 50    1  2
#&gt; 35:     55      p1        a2 50    1  3
#&gt; 36:     56      p1        a2 50    1  4
#&gt; 37:     57      p1        a2 50    2  1
#&gt; 38:     58      p1        a2 50    2  2
#&gt; 39:     59      p1        a2 50    2  3
#&gt; 40:     60      p1        a2 50    2  4
#&gt;     job.id problem algorithm  n mean sd
#&gt; </div><div class='input'>
<span class='co'># Chunk jobs per algorithm and submit them:</span>
<span class='no'>ids</span> <span class='kw'>=</span> <span class='fu'><a href='chunkIds.html'>chunkIds</a></span>(<span class='fu'><a href='getJobTable.html'>getJobPars</a></span>(<span class='kw'>reg</span> <span class='kw'>=</span> <span class='no'>tmp</span>), <span class='kw'>group.by</span> <span class='kw'>=</span> <span class='st'>"algorithm"</span>, <span class='kw'>reg</span> <span class='kw'>=</span> <span class='no'>tmp</span>)
<span class='fu'><a href='submitJobs.html'>submitJobs</a></span>(<span class='no'>ids</span>, <span class='kw'>reg</span> <span class='kw'>=</span> <span class='no'>tmp</span>)</div><div class='output'><strong class='text-info'>Submitting 80 jobs in 2 chunks using cluster functions &#39;Interactive&#39; ...</strong></div><div class='input'><span class='fu'><a href='waitForJobs.html'>waitForJobs</a></span>(<span class='kw'>reg</span> <span class='kw'>=</span> <span class='no'>tmp</span>)</div><div class='output'><strong class='text-info'>Syncing 2 files ...</strong></div><div class='output co'>#&gt; [1] TRUE
#&gt; </div><div class='input'>
<span class='co'># Reduce the results of algorithm a1</span>
<span class='no'>ids.mean</span> <span class='kw'>=</span> <span class='fu'><a href='findJobs.html'>findExperiments</a></span>(<span class='kw'>algo.name</span> <span class='kw'>=</span> <span class='st'>"a1"</span>, <span class='kw'>reg</span> <span class='kw'>=</span> <span class='no'>tmp</span>)
<span class='fu'><a href='reduceResults.html'>reduceResults</a></span>(<span class='no'>ids.mean</span>, <span class='kw'>fun</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>aggr</span>, <span class='no'>res</span>, <span class='no'>...</span>) <span class='fu'>c</span>(<span class='no'>aggr</span>, <span class='no'>res</span>), <span class='kw'>reg</span> <span class='kw'>=</span> <span class='no'>tmp</span>)</div><div class='output co'>#&gt;  [1] -1.91433603 -1.51182725 -1.98742936 -2.36910443 -0.98787171 -1.27022246
#&gt;  [7] -1.25992955 -1.34513502 -0.15700077 -0.23088698  0.07027429  0.87552783
#&gt; [13]  0.96372348  1.01272758  1.21870563  1.09210651  2.32384233  2.21704556
#&gt; [19]  2.89319252  2.39510729 -1.97107549 -1.60247254 -1.72943243 -1.13280855
#&gt; [25] -0.96364419 -1.02812339 -0.77289340 -1.46904223  0.02351158  0.17083372
#&gt; [31]  0.18285818  0.08181464  1.03563515  0.74558157  0.85903262  0.90236768
#&gt; [37]  2.06103503  1.88740822  1.88288169  1.96829931
#&gt; </div><div class='input'>
<span class='co'># Join info table with all results and calculate mean of results</span>
<span class='co'># grouped by n and algorithm</span>
<span class='no'>ids</span> <span class='kw'>=</span> <span class='fu'><a href='findJobs.html'>findDone</a></span>(<span class='kw'>reg</span> <span class='kw'>=</span> <span class='no'>tmp</span>)
<span class='no'>pars</span> <span class='kw'>=</span> <span class='fu'><a href='getJobTable.html'>getJobPars</a></span>(<span class='no'>ids</span>, <span class='kw'>reg</span> <span class='kw'>=</span> <span class='no'>tmp</span>)
<span class='no'>results</span> <span class='kw'>=</span> <span class='fu'><a href='reduceResultsList.html'>reduceResultsDataTable</a></span>(<span class='no'>ids</span>, <span class='kw'>fun</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>res</span>) <span class='fu'>list</span>(<span class='kw'>res</span> <span class='kw'>=</span> <span class='no'>res</span>), <span class='kw'>reg</span> <span class='kw'>=</span> <span class='no'>tmp</span>)
<span class='no'>tab</span> <span class='kw'>=</span> <span class='fu'><a href='JoinTables.html'>ljoin</a></span>(<span class='no'>pars</span>, <span class='no'>results</span>)
<span class='no'>tab</span>[, <span class='fu'>list</span>(<span class='kw'>mres</span> <span class='kw'>=</span> <span class='fu'>mean</span>(<span class='no'>res</span>)), <span class='kw'>by</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"n"</span>, <span class='st'>"algorithm"</span>)]</div><div class='output co'>#&gt;      n algorithm       mres
#&gt; 1:  50        a1 0.10142547
#&gt; 2: 100        a1 0.05658836
#&gt; 3:  50        a2 0.13367759
#&gt; 4: 100        a2 0.03343343
#&gt; </div></pre>
  </div>
  <div class="col-md-3">
  </div>
</div>

      <footer>
      <p>Built by <a href="http://hadley.github.io/pkgdown/">pkgdown</a>. Styled with <a href="http://getbootstrap.com">Bootstrap 3</a>.</p>
      </footer>
   </div>

  </body>
</html>
